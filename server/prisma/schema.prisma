generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("SCHED_DATABASE_URL")
}

model Group {
  id       Int      @id
  name     String
  specId   Int
  specName String
  lessons  Lesson[]
  User     User[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}

model Flow {
  id             Int      @id
  name           String
  disciplineId   Int
  disciplineName String
  lessons        Lesson[]
  User           User[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}

model Teacher {
  id        Int      @id
  name      String
  shortname String
  state     String
  Lesson    Lesson[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}

enum LessonType {
  Lection
  Practice
  Lab
  Other
  Military
  Window
  Exam
  Consult
  CourseWork
  Test
  Unknown
}

model Lesson {
  id            Int        @id // I trust in ssau's autoincremented ids :D
  type          LessonType
  discipline    String
  isOnline      Boolean
  building      String?
  room          String?
  groups        Group[]
  flows         Flow[]
  isIet         Boolean    @default(false)
  subgroup      Int?
  teacher       Teacher    @relation(fields: [teacherId], references: [id])
  teacherId     Int
  dayTimeSlot   Int
  date          DateTime
  startTime     DateTime
  endTime       DateTime
  weekNumber    Int
  weekday       Int
  conferenceUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}

model User {
  id                  Int      @id
  staffId             Int? // LK id
  fullname            String?
  group               Group?   @relation(fields: [groupId], references: [id])
  groupId             Int?
  flows               Flow[]
  authCookie          String?
  authCookieExpiresAt DateTime @default(value: "1970-01-01T00:00:00.000Z")
  sessionExpiresAt    DateTime @default(value: "1970-01-01T00:00:00.000Z")
  username            String?
  password            String?
  notifyOnNextLesson  Boolean  @default(true)
  notifyOnNextDay     Boolean  @default(true)
  notifyOnNextWeek    Boolean  @default(true)
  Ics                 Ics?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}

model Ics {
  id         Int      @id
  user       User     @relation(fields: [id], references: [id])
  validUntil DateTime @default(value: "1970-01-01T00:00:00.000Z")
  file       Bytes    @default("")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
}
